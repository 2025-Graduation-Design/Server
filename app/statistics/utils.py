import random
from collections import Counter

emotion_group_mapping = {
    1: "신남/기대",   2: "신남/기대",
    3: "만족/편안",   4: "만족/편안",
    5: "허무/우울",   6: "허무/우울",
    7: "슬픔/분노",   8: "슬픔/분노"
}

emotion_group_priority = ["신남/기대", "만족/편안", "허무/우울", "슬픔/분노"]

emotion_messages = {
    "신남/기대": {
        "messages": [
            "이번 달은 정말 활기 가득한 한 달이었죠!",
            "에너지가 뿜뿜 넘쳤던 날들이 많았어요, 히히.",
            "요즘 나 자신, 진짜 잘 달리고 있는 것 같아요!",
            "작은 일에도 웃음이 자주 났던 한 달이었죠?",
            "하루하루가 신나는 챌린지처럼 느껴졌어요.",
            "좋은 기운이 계속 곁에 머물렀던 느낌이에요.",
            "무언가에 폭 빠져 몰입했던 순간들, 기억나죠?",
            "마음이 자주 들뜨고, 기분 좋은 날이 많았던 것 같아요.",
            "새로운 일들에 설레는 마음이 자주 들었던 한 달이었어요.",
            "하루하루가 재미있는 이벤트처럼 느껴졌을지도 몰라요.",
            "기분 좋은 기대감이 자주 피어올랐던 것 같아요.",
            "무언가 시작하고 싶다는 생각이 자주 들지 않았나요?"
        ],
        "suggestions": [
            "이 기운으로 새로운 도전, 시작해보는 건 어때요?",
            "좋았던 순간들을 사진이나 글로 남겨보면 좋아요.",
            "지금의 에너지를 주변 사람들과 나눠보는 것도 좋을 것 같아요.",
            "버킷리스트 하나 꺼내서 시도해보는 건 어때요?",
            "지금의 나를 더 믿어봐도 좋아요!",
            "좋아하는 사람들과 함께하는 시간, 더 많이 가져보세요.",
            "새로운 프로젝트를 시작해도 충분히 잘 해낼 수 있을 거예요.",
            "지금 이 기분, 짧게라도 일기에 남겨두면 오래 기억될 거예요.",
            "좋은 에너지를 담아서 오늘 하루를 기록해보는 건 어때요?",
            "지금 느끼는 이 기쁨을 음악이나 춤으로 표현해보는 것도 재밌을 거예요.",
            "흥이 날 때는 살짝 산책하거나 몸을 움직여보는 것도 좋아요!",
            "새로운 모임이나 커뮤니티에 살짝 발을 들여보는 것도 좋은 자극이 될 수 있어요."
        ]
    },
    "만족/편안": {
        "messages": [
            "잔잔하고 만족스러운 시간이 많았던 것 같아요.",
            "감정이 안정되고 평온했던 한 달이었죠.",
            "바쁘지 않아도 충실한 나날을 보내셨을 거예요.",
            "나에게 집중하는 조용한 시간이 많았던 느낌이에요.",
            "감정의 파도가 고요했던 날들이었어요.",
            "무리하지 않고, 나만의 페이스를 잘 지켜낸 달이었죠.",
            "작은 것에서 기쁨을 발견하는 날들이 있었어요.",
            "자연스럽게 미소 지어지는 날이 자주 있었던 것 같아요.",
            "일상이 안정감 있게 흘러간 느낌이네요.",
            "크게 흔들림 없이 편안하게 머무를 수 있었던 시간이었어요.",
            "감정의 결이 부드럽고 잔잔했던 날들이 많았어요.",
            "마음을 쉴 수 있었던 공간들이 있었던 것 같아요."
        ],
        "suggestions": [
            "일상의 고마움을 짧게라도 글로 남겨보는 건 어때요?",
            "지금 이 고요함을 지키면서, 소소한 취미도 해보면 좋겠어요.",
            "따뜻한 차 한 잔으로 하루를 정리해보는 것도 좋을 것 같아요.",
            "감정이 편안할 때, 좋은 기억들을 기록해두면 나중에 힘이 돼요.",
            "책 한 권 천천히 읽는 여유도 멋진 시간이 될 거예요.",
            "잠깐이라도 산책을 하며 자연을 느껴보는 건 어때요?",
            "잔잔한 음악으로 마음을 더 다독여보는 것도 좋겠어요.",
            "오늘의 나, 정말 잘해냈다고 스스로 칭찬해보세요.",
            "좋았던 순간 하나를 사진과 함께 저장해보는 것도 좋아요.",
            "마음을 정돈할 수 있는 루틴을 하나 정해보면 더 편안해질 수 있어요.",
            "식물이나 반려동물과 함께 보내는 시간도 마음을 다독여줄 거예요.",
            "자기 전, 오늘 가장 마음에 들었던 순간을 하나 떠올려보세요."
        ]
    },
    "허무/우울": {
        "messages": [
            "조금 허무하거나 무기력한 순간들이 많았던 것 같아요.",
            "감정이 납작하게 가라앉은 느낌, 공감해요.",
            "힘이 잘 나지 않는 날들이 이어졌던 달이었죠.",
            "기억이 흐릿할 만큼 멍한 날들이 있었을지도 몰라요.",
            "정신은 멀쩡한데 마음은 공허한 기분, 알 것 같아요.",
            "감정의 색이 흐려졌던 날들이 있었던 것 같아요.",
            "해야 할 걸 알지만 손이 잘 가지 않았던 날들... 충분히 이해돼요.",
            "그저 하루를 버텨낸 것만으로도 잘한 거예요.",
            "무언가 해도 큰 의미가 없다는 생각이 들었던 순간들이 있었죠.",
            "하루가 금방 지나가는데 기억에 남는 일이 별로 없었던 느낌이에요.",
            "계속 뭔가 놓치고 있는 것 같은 기분이 들었을지도 몰라요.",
            "아무 생각 없이 시간만 흘러갔던 날들도 있었던 것 같아요."
        ],
        "suggestions": [
            "햇살 아래 잠깐이라도 걷는 것부터 시작해보면 어때요?",
            "크게 바꾸기보다는, 익숙한 루틴부터 다시 시작해보세요.",
            "애쓰지 않아도 괜찮아요. 가끔은 멈춰도 되는 법이죠.",
            "감정이 없다고 느끼는 것도, 분명한 감정이에요. 인정해줘야 해요.",
            "아무 생각 없이 멍 때리는 시간도 꽤 중요한 거 알아요?",
            "귀찮음을 억지로 밀어내기보다, 그냥 그대로 두는 것도 방법이에요.",
            "지금은 뭔가를 하지 않아도 괜찮아요. 있는 그대로 괜찮아요.",
            "작고 사소한 기쁨 하나라도 발견되면, 그걸 꼭 붙잡아보세요.",
            "한 가지 작은 일이라도 해냈다면, 꼭 스스로를 칭찬해줘요.",
            "말이 안 나올 땐, 그냥 단어 몇 개라도 적어보는 것도 괜찮아요.",
            "하루에 한 번, 창밖을 바라보며 잠깐 멍 때려보는 시간을 가져보세요.",
            "어디에도 공유하지 않아도 괜찮은 ‘나만의 메모장’을 열어봐요."
        ]
    },
    "슬픔/분노": {
        "messages": [
            "감정의 깊이가 유난히 깊었던 한 달이었죠.",
            "마음을 툭 건드리는 일들이 있었던 것 같아요.",
            "속이 무겁고 복잡한 날들이 많았을지도 몰라요.",
            "눈물이 자꾸 차오르거나, 사소한 일에도 화가 났을 수 있어요.",
            "설명하기 어려운 감정들이 마음을 가득 채웠던 것 같아요.",
            "생각이 너무 많아서 쉽게 잠들기 어려운 날들도 있었죠.",
            "혼자 있는 시간은 많았는데, 마음은 복잡했던 느낌이에요.",
            "나도 왜 그런지 모르겠는 날들이 반복됐을 수도 있어요.",
            "감정이 복잡하게 뒤섞여서 말로 풀기 어려웠던 순간들이 있었죠.",
            "작은 일에도 예민해졌던 날들이 생각나네요.",
            "누구에게도 털어놓기 힘든 감정이 쌓였던 시간일지도 몰라요.",
            "스스로를 다독이기 어려웠던 날들이 계속됐던 것 같아요."
        ],
        "suggestions": [
            "지금 느낀 감정을 정리해보는 글쓰기를 살짝 해보면 어때요?",
            "위로가 되는 영화나 음악을 찾아보는 것도 도움이 될 수 있어요.",
            "자신을 탓하지 말고, 조용히 숨 한 번 크게 쉬어보는 거 어때요?",
            "아무한테도 말 못 한 이야기, 그냥 나에게 써봐도 괜찮아요.",
            "힘들 때는 스스로를 다그치지 말고 안아주는 게 더 중요해요.",
            "이 감정, 지나갈 거예요. 지금 여기에만 머무르지 않아요.",
            "혼자서 끙끙 안고 있지 않아도 괜찮아요. 누군가에게 기대도 돼요.",
            "아무것도 하지 않아도 괜찮아요. 지금 그대로도 충분히 괜찮은 당신이에요.",
            "감정을 솔직하게 말로 내뱉어보는 것도 괜찮아요. 혼잣말이어도요.",
            "지금 이 감정을 글이나 그림으로 흘려보내듯 표현해보면 어때요?",
            "누군가의 따뜻한 말 한 줄이 위로가 되듯, 스스로에게도 한 줄 남겨보세요.",
            "지금 힘든 마음을 꼭 누르지 말고, 잠깐이라도 가만히 안아줘보세요."
        ]
    }
}


def summarize_emotions(emotion_ids: list[int]):
    groups = [emotion_group_mapping[e] for e in emotion_ids if e in emotion_group_mapping]
    counter = Counter(groups)

    # 동률인 경우 positivity 우선순위 적용
    max_count = max(counter.values(), default=0)
    candidate_groups = [group for group, count in counter.items() if count == max_count]

    for preferred in emotion_group_priority:
        if preferred in candidate_groups:
            top_group = preferred
            break
    else:
        top_group = candidate_groups[0]  # fallback

    message = random.choice(emotion_messages[top_group]["messages"])
    suggestion = random.choice(emotion_messages[top_group]["suggestions"])

    return {
        "top_emotion_group": top_group,
        "group_distribution": dict(counter),
        "message": message,
        "suggestion": suggestion
    }