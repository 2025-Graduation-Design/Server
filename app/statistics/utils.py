import random
from collections import Counter

emotion_group_mapping = {
    1: "positive_active", 2: "positive_active",
    3: "positive_calm",   4: "positive_calm",
    5: "negative_flat",   6: "negative_flat",
    7: "negative_deep",   8: "negative_deep"
}

emotion_messages = {
    "positive_active": {
        "messages": [
            "이번 달은 정말 활기가 넘쳤어요!",
            "에너지가 뿜뿜한 한 달이었네요.",
            "자기 자신이 잘 달리고 있다는 증거예요!",
            "작은 일에도 웃음이 많았던 달이었네요.",
            "하루하루가 신나는 챌린지 같았어요.",
            "긍정의 기운이 당신을 감싸고 있었어요.",
            "진심으로 무언가에 몰입했던 순간들이 많았어요.",
            "마음이 자주 들뜨고, 좋았던 감정이 오래 남아 있었어요."
        ],
        "suggestions": [
            "지금의 기운으로 새로운 도전, 어떤가요?",
            "소중한 순간들을 사진이나 글로 남겨보세요.",
            "이 에너지를 주위에도 나눠보는 건 어때요?",
            "지금의 긍정 에너지로 버킷리스트 하나 꺼내봐요!",
            "자기 자신을 더 믿어도 좋아요.",
            "좋아하는 사람들과 시간을 더 많이 보내보세요.",
            "새로운 프로젝트를 시작해도 잘 해낼 수 있어요.",
            "지금의 감정을 오래 기억할 수 있도록 일기 한 줄 남겨보세요."
        ]
    },
    "positive_calm": {
        "messages": [
            "잔잔하고 만족스러운 시간이 많았어요.",
            "감정이 안정되고 평온했던 한 달이네요.",
            "바쁘지 않더라도 충실한 나날을 보내셨어요.",
            "나에게 집중하는 조용한 시간이 많았던 것 같아요.",
            "감정의 파도가 잔잔했던 한 달이었네요.",
            "무리하지 않고, 자기 페이스를 잘 지켰어요.",
            "작은 것에서 기쁨을 발견할 수 있었던 시간이었어요.",
            "자연스레 미소 짓는 날이 많았던 것 같아요."
        ],
        "suggestions": [
            "일상의 감사를 글로 남겨보세요.",
            "이 고요함을 방해하지 않게 조용한 취미를 가져보는 건 어때요?",
            "명상이나 따뜻한 차 한잔으로 하루를 마무리해봐요.",
            "마음이 평온할 때, 작은 기쁨들을 기록해두면 나중에 큰 힘이 돼요.",
            "책 한 권을 천천히 읽는 여유를 즐겨보세요.",
            "잠깐의 산책도 마음을 더 안정시켜줄 수 있어요.",
            "마음을 가볍게 만들어주는 음악을 들어보세요.",
            "자기 자신을 칭찬해주는 말을 해보는 것도 좋아요."
        ]
    },
    "negative_flat": {
        "messages": [
            "조금 허무하거나 무기력한 시간이 많았던 것 같아요.",
            "감정이 납작하게 가라앉은 느낌이 들었던 한 달이네요.",
            "조금은 힘 빠진 나날들이었을 수 있어요.",
            "무슨 일이 있었는지도 기억이 안 날 만큼 멍한 날들이 많았죠.",
            "정신은 멀쩡한데 마음은 공허한 느낌, 공감해요.",
            "감정의 색이 옅어진 것 같은 기분이 들었을지도 몰라요.",
            "해야 할 건 알지만 손이 가지 않았던 시간이었죠.",
            "그저 버티는 것만으로도 충분히 잘한 달이었어요."
        ],
        "suggestions": [
            "햇볕을 쬐며 산책하는 것부터 시작해봐요.",
            "큰 변화보다 사소한 루틴이 도움될 수 있어요.",
            "너무 애쓰지 않아도 돼요. 쉬어도 괜찮아요.",
            "감정이 없다는 것도 하나의 감정이에요. 무시하지 말아요.",
            "그냥 멍하게 있는 것도 괜찮아요. 그게 회복일 수 있어요.",
            "귀찮음을 이기려 하지 말고, 그냥 흐름을 지켜보세요.",
            "지금은 뭔가를 하기보단, '그냥 있기'에 집중해도 돼요.",
            "사소한 기쁨 하나라도 발견하면 그걸 붙잡아보세요."
        ]
    },
    "negative_deep": {
        "messages": [
            "감정의 깊이가 깊었던 한 달이에요.",
            "무언가 마음 속을 뒤흔든 일이 있었을지도 몰라요.",
            "마음이 무겁고 복잡한 시간이었네요.",
            "자주 눈물이 차오르거나, 괜히 화가 났을 수도 있어요.",
            "말로 설명할 수 없는 감정들이 마음을 채웠죠.",
            "생각이 많아 잠들기 어려운 날이 있었던 것 같아요.",
            "혼자 있는 시간이 많았지만, 생각은 너무 많았죠.",
            "내가 왜 이러는지도 잘 모를 만큼 복잡했을 거예요."
        ],
        "suggestions": [
            "지금 느낀 감정을 정리해보는 글쓰기를 추천해요.",
            "위로받을 수 있는 콘텐츠를 찾아보는 것도 좋아요.",
            "자기 자신을 탓하지 말고, 천천히 숨 고르기를 해봐요.",
            "아무에게도 말하지 못한 이야기를 나에게 써보는 건 어때요?",
            "힘들 땐 강해지려고 말고, 그냥 안아주는 게 더 중요해요.",
            "지금의 감정은 지나가요. 절대 여기 머무르지 않아요.",
            "혼자일 필요 없어요. 누군가에게 마음을 살짝 열어도 괜찮아요.",
            "아무것도 하지 않아도 괜찮아요. 있는 그대로의 당신으로 충분해요."
        ]
    }
}

def summarize_emotions(emotion_ids: list[int]):
    groups = [emotion_group_mapping[e] for e in emotion_ids if e in emotion_group_mapping]
    counter = Counter(groups)
    top_group = counter.most_common(1)[0][0]

    message = random.choice(emotion_messages[top_group]["messages"])
    suggestion = random.choice(emotion_messages[top_group]["suggestions"])

    return {
        "top_emotion_group": top_group,
        "group_distribution": dict(counter),
        "message": message,
        "suggestion": suggestion
    }